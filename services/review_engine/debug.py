import os, time, jwt

app_id = os.getenv("GITHUB_APP_ID", "1941950").strip()
private_key = os.getenv("GITHUB_APP_PRIVATE_KEY", """-----BEGIN RSA PRIVATE KEY-----
MIIEpQIBAAKCAQEAmfJvVuXEV9bQvGLOQcDDajnkycJN2GT3Du4VzFfdM2jJy44o
mSsKaqXtwPyLds3p9kcr/0k7IRcBjNWfir52JxrM5TLBTzLzV0fE41v+yFiLIw2H
5XjSZ97KiMpDbCE1fzLQdP+c4XL8AcGJllhd46t0qKYOXb55jpC+uc6YV+ptjbSs
cluheQ387g/pRBQUxNyxUMRr1T0rMyUk3Ma+MKqMr4N2FTujZF2k0h+8BQIvBCfN
R53dpPfzgDWHCvF/LfFmlIx9lUFG41WTVoV7W6vGdEHERgmbX0tC6ijOSjtG6y47
M8aN/xR8A6DwgI6kVna0Zm/kaGGsEXBR7zxY4wIDAQABAoIBABA15B19YlhxiVdc
/CUWXD1yTTIloLbZot5Smb8DvYotTZp+pK3ER3uFb2yz6yeedTV2tx5RosVQO9yN
nhgpCB4EB3FXD938Gn2lVAkw5bpJAJW3VgkG2PkRD7ipu8HGGXEEc8juJaHjzr+M
lqVbNr/DjSw5GCgs53Xorfy40XfoUMKchn1it8rBHvc+vRZv5OcNelonmV3kARw1
ipqVBoMuohSdTGN0s8s0kaqFlowXlhLLtxS1t645CSZt8FMaUYCeDwh/UE9cwXq6
PBI/IxAoQoT3hZIJjl9U5DN4y1ASq0yZQVog9uVcRkZenVj+/DR89DudVahMTFXa
fxSdiIkCgYEAyZaVrEKv3iBi03qqRy4VZnIY353KUfzKZ3OOfYWXpCHl0VJnXWTK
W/y5CnU9mKTUYdk7GrnFEZ/dolq3DYzhCnm7ZXxQW/4+Mbjkn+M7tDWnAWtNW94O
MdUBB2qWnX/HQs8uhAoyCoQlsFT/mfuUPpF5sBaQyapHz+JDbbrvUC0CgYEAw3/r
uu5fyKIyPTWbHQQKgIL5x2Zpl6g/KfotFc7eowu4oPquCEPI4/2lYwMZ9xhIIi19
+GPmEBfryOAVgHcHfkbxNDrCKp3C1pEYvnWUltaofJPzwdx1hHBjGqeijtWVKoft
ikyMy/Qxi4Tmt9Y+RqDZ0rGGP9CwE2Cq8kJy508CgYEAx7GFOSyifP9GBsqXzYVI
K8DRBQuRNWCevJZLS+q/yhbOS2o+/NRwZWlXgJWdXA3EWd3QX+ww3QGpk0Ab369z
6mWmjqT0Ef0sbSMET6LRLPaNJqm960hwdUrVBxy+cOz4XiVQpfpXkfVQRHoe7dG7
C7QegKIJ8cvd8X/pXdT1Zk0CgYEAgnjq//R6pFHrKYKPJMw/ngjLXlJxAi/dB8zZ
LgbD+xilfXoPj6B9f/sV14CIYaoo6fZmbdFuByuPxp4We4f0zkfWTj8wunRTRhPL
6cBbDFfyVkH/mk/hdiPzYCSkjqLoTFwvIe94v90W+8AUongvU7+h38VujURfXm9T
Zx8FxG0CgYEAriYFVkMvkkYjvMElAdqAMjekoV0wckf4UZ1UAkroJs9hUfzf1Gbp
g5HPkcSoCiTU615pXyTdk2aL2lccxKSeH/d8J9EfBomZy5Ii9UoEbLJYM4vN8rYN
HHyVf4slVxNKNeqM+v+3iAYV3GPbkIWwRZr6+HNYWydPbWSMr3xt/U0=
-----END RSA PRIVATE KEY-----""").strip()

now = int(time.time())
payload = {"iat": now - 60, "exp": now + 600, "iss": app_id}

token = jwt.encode(payload, private_key, algorithm="RS256")
print(token)

curl -H "Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTgyOTAyODksImV4cCI6MTc1ODI5MDk0OSwiaXNzIjoiMTk0MTk1MCJ9.gdYWci70JdZDFDqfU_BqJWsgX1Xe-GbNxS3oj7CVeN6UUfyWQ4zwGItFrNImoXFie_y4FAKXq0GOcWfHjQub6MemlrmGPjOV9R9KQF3qpXY3mQULmaYxSNCNVqV6_h9NXyANeLAxJVNwft3oaPnNPFxBFlB5zPWY5_rJ3Ww39Y8tZflwcP-W_iO-Mk-neBXWdi5j1G_nneEbY4JR9xVPI1_4nxCRCDDqGth_NWqriz3XWByZXByMZ38vaqYLbvpecaaSmJBTshHptaNl04tv2jE0vsqkYbfDweUe6GXIaivtPMQnew1zr8CnsMTv65dij8yZAnZ5dG0UkFHyTrYFzQ" \
     -H "Accept: application/vnd.github+json" \
     https://api.github.com/app

curl -H "Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NTgyOTAyODksImV4cCI6MTc1ODI5MDk0OSwiaXNzIjoiMTk0MTk1MCJ9.gdYWci70JdZDFDqfU_BqJWsgX1Xe-GbNxS3oj7CVeN6UUfyWQ4zwGItFrNImoXFie_y4FAKXq0GOcWfHjQub6MemlrmGPjOV9R9KQF3qpXY3mQULmaYxSNCNVqV6_h9NXyANeLAxJVNwft3oaPnNPFxBFlB5zPWY5_rJ3Ww39Y8tZflwcP-W_iO-Mk-neBXWdi5j1G_nneEbY4JR9xVPI1_4nxCRCDDqGth_NWqriz3XWByZXByMZ38vaqYLbvpecaaSmJBTshHptaNl04tv2jE0vsqkYbfDweUe6GXIaivtPMQnew1zr8CnsMTv65dij8yZAnZ5dG0UkFHyTrYFzQ" \
     -H "Accept: application/vnd.github+json" \
     https://api.github.com/app/installations
